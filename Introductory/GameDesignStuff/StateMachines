TODO - introduce the state machine
